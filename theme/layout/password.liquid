<!DOCTYPE html> 
<html>
    <head>
        {% include "_preflight-css" %}
        {{ content_for_header }}
    </head>

    <!-- Body Start -->
    <body style="position: relative;">
        {% include "_global-content" %}
        |||GLOBAL_SECTIONS_ABOVE_LAYOUT|||
        <div style="opacity: 0">
            {{ content_for_layout }}
        </div>
        |||GLOBAL_SECTIONS_BELOW_LAYOUT|||

        {% if request.design_mode = false %}
        <iframe id=""theme-editor" style="
        width: 100%;
        height: 100%;
        overflow: hidden;
        position: absolute;
        inset: 0;
        z-index: 10;
        min-height: 100vh
        "
        src="|||DEPLOYMENT_URL||| {{request.path }}"
        frameborder="0"></iframe>

        <script>
            const sessionUrl = sessionStorage.getItem('admirable-cms-url') ?? "||| DEVELOPMENT_URL |||";
            const themeEditorIframe = document.getElementById("theme-editor");
            themeEditorIframe.setAttribute('src', `${sessionUrl}{{request.path}}`)

            if (sessionUrl === `||| DEVELOPMENT_URL |||`) {
                fetch('||| DEVELOPMENT_URL |||{{request.path}}', { method: 'HEAD' }).catch(err => {
                    themeEditorIframe.setAttribute('src', '|||DEPLOYMENT_URL|||{{request.path}}');
                    sessionStorage.setItem('admirable-cms-url', `|||DEPLOYMENT_URL |||`)
                });
            }

            if(sessionUrl !== `|||DEVELOPMENT_URL |||`) {
                fetch('||| DEVELOPMENT_URL |||{{request.path}}', { method: 'HEAD' }).then((e) => {
                    themeEditorIframe.setAttribute('src', '|||DEVELOPMENT_URL|||{{request.path}}');
                    sessionStorage.setItem('admirable-cms-url', `|||DEVELOPMENT_URL|||`)
                }).catch(err => {
                    sessionStorage.setItem('shopify-cms-url', `|||DEVELOPMENT_URL|||`)
                });
            }
        </script>

        {% endif %}

        
    </body>
</html>